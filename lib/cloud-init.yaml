#cloud-config

ssh_pwauth: false
disable_root: true

users:
  - name: dev
    shell: /bin/bash
    sudo: ALL=(ALL) NOPASSWD:ALL
    ssh_import_id:
      - gh:rodmk

write_files:
  - path: /etc/systemd/system/ssh.service.d/priority.conf
    content: |
      [Service]
      CPUWeight=200
  - path: /etc/systemd/system/et.service.d/priority.conf
    content: |
      [Service]
      CPUWeight=200

runcmd:
  - systemctl daemon-reload
  - systemctl restart ssh
  - su - dev -c 'sh -c "$(curl -fsLS get.chezmoi.io)" -- init --apply rodmk && bash -ic dotfiles-deps'
